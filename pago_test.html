<!DOCTYPE html>
<meta charset="utf-8">
<title>TEST MP – VerazYa</title>
<div style="font-family:system-ui;max-width:640px;margin:40px auto">
  <h1>Prueba rápida de pago</h1>
  <p>Este botón llama a tu Apps Script por <b>GET</b> y debería abrir Mercado Pago.</p>
  <button id="test" style="padding:12px 16px;border-radius:10px;background:#e11d48;color:#fff;border:0;cursor:pointer">Probar pago $8.000</button>
  <pre id="log" style="background:#111;color:#ddd;padding:10px;border-radius:8px;margin-top:16px;white-space:pre-wrap"></pre>
</div>
<script>
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbxPteROZ7Fih9dCH-74TN1Y-o3WZ5_nQ2xaV_E_LPijOXORFAFoO1DhBk_ywd8lnkjF/exec";
const log = (...a)=>{ document.getElementById('log').textContent += a.join(' ') + "\n"; console.log(...a); };

document.getElementById('test').addEventListener('click', async ()=>{
  const q = new URLSearchParams({
    route: 'create',
    nombre: 'Test',
    apellido: 'Bot',
    dni: '12345678',
    email: 'powerluzx@hotmail.com',
    whatsapp: '3794143204',
    notas: 'test',
    monto: '8000'
  });
  const url = WEBAPP_URL + '?' + q.toString();
  log('GET', url);
  try{
    const res = await fetch(url, { method:'GET' });
    const txt = await res.text();
    log('HTTP', res.status, res.statusText);
    log('RAW', txt.slice(0,200));
    let data = {}; try{ data = JSON.parse(txt); } catch(e){ log('JSON error', e.message); }
    if (data.ok && data.init_point){ window.location.href = data.init_point; }
    else { alert('No se pudo crear preferencia. Ver log.'); }
  }catch(e){
    log('FETCH ERROR', e.message);
    alert('Error de red. ¿Bloqueador? Probá incógnito.');
  }
});
</script>
